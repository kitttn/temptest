The developer release includes a [tarball](http://storage.googleapis.com/mdk/unipro_bridge_firmware_devcon2_v0.2.tar.gz) with the necessary source and tools to build firmware for APBridge 1 and APBridge 2.

#### What's Inside

The firmware tarball contains:

1. RTOS support for the Toshiba Bridge ASICs.
2. A development snapshot of firmware libraries supporting the Greybus Specification for UniPro communication by Project Ara modules using Toshiba Bridge ASICs.
3. Example programs that exercise these libraries.

The firmware currently is based on an open source (BSD Licensed) RTOS called [NuttX](http://www.nuttx.org/). However, our libraries have minimal dependency on that RTOS, and we expect they will port to other RTOSes with POSIX APIs straightforwardly.

You will now build two of these example programs, which allow you to tunnel I2C and GPIO traffic through UniPro.

#### Limitations

This is an **early snapshot release**, meant to get early-stage module developers up and running, and let you familiarize yourself with our code base, while we continue platform development in parallel. As such, the release contains some limitations that you should know about.

- The Supervisory Controller (SVC) on your BDB1B has been pre-flashed with firmware that establishes routes on the UniPro switch for these example programs. They are the only UniPro CPort connections which may be used at the present time. An upcoming release will relax this requirement and let you set your own routes, so you can use other bridges and other CPorts.

- The APBridge to SVC, and AP to module, communication paths needed to fully implement module manifest passing from modules and other Greybus Control Protocol features are unimplemented. These are required for hotplug and module discovery and enumeration as described in the Greybus Specification. For now, we hard-code module manifests for other bridges on the network in the APBridge attached to the AP. These issues will also be addressed in upcoming releases.

#### Prerequisites

Please finish the [Development Machine Setup](Development-Machine-Setup) before proceeding.

#### Building the Firmware

First, extract the [tarball](http://storage.googleapis.com/mdk/unipro_bridge_firmware_devcon2_v0.2.tar.gz), then cd into the resulting directory (we assume the tarball is in `$HOME/Downloads`):
````
cd $HOME
tar xzf $HOME/Downloads/unipro_bridge_firmware_devcon2_v0.2.tar.gz
cd unipro_bridge_firmware_devcon2_v0.2
````
If you haven't already, you'll need to do a one-time build and install of kconfig support:
````
cd misc/tools/kconfig-frontends
./bootstrap
./configure --enable-mconf
make
sudo make install
sudo ldconfig
cd ../../..
````
Note: The above instructions assume that /usr/local exists on your system, and is referenced by the system path and by the dynamic linker configuration database.

Now you're ready to build firmware for the APBridge 1 and APBridge 2 chips on the BDB1B!

First, cd into the nuttx subdirectory of your working directory
````
cd $HOME/unipro_bridge_firmware_devcon2_v0.2
cd nuttx
````

Next, build the APBridge 2 firmware image:
````
cd tools
./configure.sh bdb/apb2
cd ..
make
````

**Note:** there are issues with the build system dependency tracker that have led us to deprecate the use of parallel make (`make -jN`) in the above step.

Note that there is a nuttx subdirectory where `make` is run, and the ELF file generated by a successful `make` is also named nuttx.  **Keep track of your build outputs**, so that you donâ€™t, for example, assume that an APBridge 1 firmware image is an APBridge 2 firmware image.  We recommend copying the nuttx ELF file to a known location with a unique name, like this:
````
cp nuttx $HOME/nuttx.apb2
````

**Don't copy nuttx.bin.**

Next, you'll configure and build an image for AP Bridge 1 on the BDB1B.

When switching configurations, run `make distclean` first, like this:
````
make distclean
cd tools
./configure.sh bdb/apb1
cd ..
make
cp nuttx $HOME/nuttx.apb1
````

**Note:** there are issues with the build system dependency tracker that have led us to deprecate the use of parallel make (`make -jN`) in the above step.

The builds should complete successfully if the necessary prerequisites have been installed.  As a general note, if you're in a compile-load-test cycle, and a build fails, you'll want to ensure that old build products have been cleaned up.  Your safest bet will be `make distclean` followed by a reconfigure, as `make clean` doesn't always work due to unknown causes.

#### Next Steps

Now you're ready to [Load the Example Firmware into the APBridges](Loading-Example-Firmware-into-the-APBridges).
